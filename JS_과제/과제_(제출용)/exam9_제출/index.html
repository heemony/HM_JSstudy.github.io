<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>exam - anchor Nav</title>
<style>
/* temporary css */
body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,p,table,th,td,form,fieldset,legend,textarea,input,select,textarea,button,pre{margin:0;padding:0}
html,body{width:100%;height:100%}
body{position:relative;min-width:1280px}
body,input,select,textarea,button,th,td{font-family:'돋움','Dotum',sans-serif,'Apple SD Gothic Neo';font-size:11px;color:#555}
fieldset,img{border:0 none}
ul,ol,dl,li{list-style:none}
li{vertical-align:top}
hr{display:none}
input,select,textarea,button{vertical-align:top}
button,input[type=button]{overflow:visible;border:0;background-color:transparent;cursor:pointer}
button::-moz-focus-inner{padding:0;border:0}
input[type="text"],input[type="password"],button{-webkit-appearance:none;border:0 none;border-radius:0;background:none}
button span{position:relative}
address,caption,em{font-style:normal}
a{color:#555;cursor:pointer}
a,a:active,a:hover{text-decoration:none}
table{border-collapse:collapse;border-spacing:0}
ins{text-decoration:none}
.blind,legend,caption span{overflow:hidden;position:absolute;top:0;left:0;width:1px;height:1px;font-size:0;line-height:999px;white-space:nowrap}
.sp{display:inline-block;overflow:hidden;width:10px;height:10px;background:url(img/sp.png) no-repeat;line-height:999px;vertical-align:top}

#wrapper{position:relative;min-width:1320px;min-height:100%;margin:0 auto;background:#f4f4f4}
#header{position:relative;height:130px;background:#191919}
#container{min-height:100%;margin:-100px 0 -80px;padding:100px 0 80px;box-sizing:border-box}
#content{width:940px;margin:0 auto;padding:30px 0}
#footer{height:80px;border-top:1px solid #dfdfdf;background:#191919}

.anchor_nav_wrap #content{width:auto;padding:0}
.section{height:229px;background-image:url(img/bg_visual.jpg);background-position:50% 0;background-repeat:no-repeat}
.section.type2{height:835px;background-image:url(img/bg_section01.jpg)}
.section.type3{height:792px;background-image:url(img/bg_section02.jpg)}
.section.type4{height:1813px;background-image:url(img/bg_section03.jpg)}
.section.type5{height:355px;background-image:url(img/bg_section04.jpg)}

.quick_menu{position:absolute;top:400px;right:5px;z-index:10;padding:62px 2px 2px;background:#000}
.quick_list{padding:13px 0 9px;background:url(img/bg_quick_menu.jpg) no-repeat; background-size:cover}
.quick_list a{display:block;padding:12px 11px 11px 16px}
.quick_menu .sp{height:17px}
.quick_menu .btn_top{position:absolute;top:2px;left:2px;padding:0}
.quick_menu .btn_top .sp{display:block;width:157px;height:60px;background-position:0 -57px}
.quick_menu .btn_top:hover .sp,
.quick_menu .btn_top:active .sp,
.quick_menu .btn_top.active .sp {background-position:-159px -57px}
.quick_menu .requirements .sp{width:130px;background-position:0 0}
.quick_menu .requirements.active .sp,
.quick_menu .requirements.active:hover .sp,
.quick_menu .requirements.active:active .sp{background-position:0 -19px}
.quick_menu .requirements:hover .sp,
.quick_menu .requirements:active .sp{background-position:0 -38px}
.quick_menu .benefits .sp{width:90px;background-position:-132px 0}
.quick_menu .benefits.active .sp,
.quick_menu .benefits.active:hover .sp,
.quick_menu .benefits.active:active .sp{background-position:-132px -19px}
.quick_menu .benefits:hover .sp,
.quick_menu .benefits:active .sp{background-position:-132px -38px}
.quick_menu .apply .sp{width:70px;background-position:-224px 0}
.quick_menu .apply.active .sp,
.quick_menu .apply.active:hover .sp,
.quick_menu .apply.active:active .sp{background-position:-224px -19px}
.quick_menu .apply:hover .sp,
.quick_menu .apply:active .sp{background-position:-224px -38px}
/* //temporary css */
</style>
</head>
<body>
<!-- wrapper [s] -->
<div id="wrapper" class="anchor_nav_wrap">
    <!-- header [s] -->
    <div id="header" role="banner"></div>
    <!-- header [e] -->
    <hr />
    <!-- container [s] -->
    <div id="container">
        <div id="content" role="main">
            <div class="quick_menu">
                <strong class="blind">quick menu</strong>
                <ul class="quick_list">
                <li><a href="#none" class="requirements active"><span class="sp">01 REQUIREMENTS</span></a></li>
                <li><a href="#none" class="benefits"><span class="sp">02 BENEFITS</span></a></li>
                <li><a href="#none" class="apply"><span class="sp">03 APPLY</span></a></li>
                <li><a href="#none" class="btn_top"><span class="sp">Go to top</span></a></li>
                </ul>
            </div>
            <div class="section"></div>
            <div class="section type2"></div>
            <div class="section type3"></div>
            <div class="section type4"></div>
            <div class="section type5"></div>
        </div>
    </div>
    <!-- container [e] -->
    <hr />
    <!-- footer [s] -->
    <div id="footer" role="contentinfo"></div>
    <!-- footer [e] -->
<!-- [ Javascript Area ] -->
<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<script src="../js/apps/util.js"></script>
<script>
/** 조건
 * [ 스티키바 조건 '.quick_list' ]
 *  - 맨 처음 : 모두 비활성화
 *  - 섹션에 맞춰서 해당 메뉴가 활성화 되어야 함.
 *  - li 마지막은 그냥 페이지 이동. 
 * 
 * 주의) 스크롤이 시작할 때 체크할 수 있고, 끝날 때 해줄 수 있으니 시점 체크를 잘 해야함. (setTimeout 해가지고..)
 * 
 * [ 누르면 해당 섹션으로 앵커되어야 함. ]
 *  - scroll.top ~으로 animate 해 줄 수 있다.
 * 
 * [ 설계 구상하기 ]
 *  - 설계 구체적으로 짜기 (어떤 함수의 어떤 성질을 어떻게 이용해서 짜겠다는 수준으로 상세히 디자인하기)
 *  - 반응형 고려해서 체크하기 (고려해야 할 값이 무엇인지)
 */

/** 계획
 * 1. 스티키바
 * 1-1. active된 메뉴 모두 비활성화 상태.
 * 1-2. 스티키바가 특정 섹션의 위치에 들어서면 add '.active' class하여 활성화로 바꿔줌 
 * 1-3. 마지막 btn_top은 최상단으로
 * 
 * 2. 스크롤 이벤트
 * - 스티키바 비활성화 : 배너부분
 *      section 
 * - 스티키바 활성화 : 섹션 시작 부분
 *      section.type2 - li[0]
 *      section.type3 - li[1]
 *      section.type4 - li[2]
 *      section.type5 - top으로 앵커
 * 
 * 3. 애니메이션
 * 
 * 
 */
</script>
<script>
(function(global, factory) {
    global = global;
    global.scrollBannerComponent = factory();
}(window, function() {
    'use strict'

    var scrollBannerComponent = (function(isUndefined) {
        var win = window,
            Util = win.Common.util;

        function scrollBannerComponent(container, args) {
            var defParams = {
                obj: container,
                quickWrap: '#content',
                quickMenu : '.quick_menu',
                quickList : '.quick_list',
                activeClass : 'active',
                section : '.section',
                topBtn: '.btn_top',
                initHeight: 400,
            };
            this.opts = Util.def(defParams, (args || {}));
            if (!(this.obj = $(this.opts.obj)).length) return;
            this.init();
        }
        scrollBannerComponent.prototype = {
            init: function() {
                this.setElements();
                this.initLayout();
                this.bindEvents();
                console.log('init', this.topBtn);
            },
            setElements: function() {
                this.quickWrap = this.obj.find(this.opts.quickWrap);
                this.quickMenu = this.obj.find(this.opts.quickMenu);
                this.quickList = this.obj.find(this.opts.quickList).children().find('a');
                this.section = this.obj.find(this.opts.section);
            },
            initLayout: function() {
                // active된 class를 다 떼준다.
                var _this = this,
                    rmvClass = this.quickList.filter(function(i, item) {
                        if ($(item).hasClass(_this.opts.activeClass)) {
                            $(item).removeClass(_this.opts.activeClass);
                        }
                    })
            },
            // 구간별로 top 값을 재고싶다. 간단하게 짤 수 있는 방법은?
            // initLayout에 높이값을 담은 변수를 같이 선언해도 좋을지 아니면 이렇게 따로 해둘지..
            initVar: function() {
                // 이 친구는 어떻게 해야할까!
                // this.section_require = $(this.section[1]).position().top;
                // this.section_benefit = $(this.section[2]).position().top;
                // this.section_apply = $(this.section[3]).position().top;
            },
            // Event Binding
            bindEvents: function() {
                $(win).on('scroll', this.scrollFunc.bind(this));
                this.quickList.on('click', this.gotoFunc.bind(this));
            },
            // Scroll event
            scrollFunc: function() {
                this.currentTop = $(win).scrollTop(); // 현재 스크롤 top 위치, 기준값
                var startPoint = $(this.section[1]).position().top, // section의 top 값
                    endPoint = $(this.section[4]).position().top, // section의 마지막값
                    endHiehgt = $(this.section[3]).outerHeight(),
                    moveRangeStart = $(this.section[1]).position().top, // 스티키바가 움직이는 범위 명시
                    moveRangeMiddle = $(this.section[2]).position().top,
                    moveRangeEnd = $(this.section[3]).position().top;
                    // 값 다시 체크하기
                
                if (this.quickList.hasClass(this.opts.activeClass)) {
                    this.quickList.removeClass(this.opts.activeClass)
                }

                if (this.currentTop >= startPoint && this.currentTop <= endPoint) { 
                    this.addActiveFunc($(this.quickList[0]));
                    this.followNavFunc();
                    if (this.currentTop > moveRangeStart && this.currentTop < moveRangeMiddle) {
                        this.addActiveFunc($(this.quickList[0]));
                        this.rmvActiveFunc($(this.quickList[1]));
                        this.rmvActiveFunc($(this.quickList[2]));
                    } else if (this.currentTop >= moveRangeMiddle && this.currentTop < moveRangeEnd) {
                        this.rmvActiveFunc($(this.quickList[0]));
                        this.addActiveFunc($(this.quickList[1]));
                        this.rmvActiveFunc($(this.quickList[2]));
                    } else if (this.currentTop >= moveRangeEnd) {
                        console.log('끗')
                        this.rmvActiveFunc($(this.quickList[0]));
                        this.rmvActiveFunc($(this.quickList[1]));
                        this.addActiveFunc($(this.quickList[2]));
                    }
                }   
            },
            followNavFunc: function() {
                var qm = $(this.quickMenu).position().top;
                if ( !this.currentTop > qm) {
                    this.quickMenu.css('top', qm);
                } 
                this.quickMenu.css('top', this.currentTop);
            },
            gotoFunc: function(e) {
                /**
                 * 메뉴 버튼을 눌렀을 때 앵커처럼 동작하기.
                 * 첫 번쨰 방법- 해당 영역의 높이값을 주어서 변경
                 * 두 번째 방법- 섹션 부분에 해쉬값을 붙여주어서 변경
                 * 세 번쨰 방법- initlayout으로 #id값 설정하기
                 */
                console.log(e.currentTarget);
                var target = e.currentTarget, // 해당 버튼은 target으로 찾았다.
                    classn = target.classList[0],
                    className = '#' + target.classList[0]; // 버튼의 클래스 이름을 찾아따. 

                console.log($('html, body'))
                console.log($(win))
                // $(target).attr('href', className);
                switch (classn) {
                    case 'btn_top':
                        console.log('btn_top 케이스문')
                        var position = 0;
                        console.log(position)
                        $('html, body').stop().animate({scrollTop: `${position.top}`}, 500);
                        break;
                    case 'requirements':
                        console.log('requirements 케이스문')
                        var position = $(this.section[1]).position();
                        console.log(position)
                        $('html, body').stop().animate({scrollTop: `${position.top}px`}, 500);
                        break;
                    case 'benefits':
                        console.log('benefits 케이스문')
                        var position = $(this.section[2]).position();
                        console.log(position)
                        $('html, body').stop().animate({scrollTop: `${position.top}px`}, 500);
                        break;
                    case 'apply':
                        console.log('apply 케이스문')
                        var position = $(this.section[3]).position();
                        console.log(position)
                        $('html, body').stop().animate({scrollTop: `${position.top}px`}, 500);
                        break;
                }
            },
            addActiveFunc: function(target) {
                target.addClass(this.opts.activeClass);
            },
            rmvActiveFunc: function(target) {
                target.removeClass(this.opts.activeClass);
            }
        }
        return scrollBannerComponent;
    })();
    return scrollBannerComponent;
}));

(function(global, factory) {
    global = global;
    $(function() {
        factory();
    })
}(window, function() {
    'use strict'
    
    var scrollBannerComponent = (function() {
        var win = window,
            Util = win.Common.util;

        function scrollBannerComponent(args) {
            var defParams = {
                obj: '#container'
            };
            this.opts = Util.def(defParams, (args || {}));
            if (!(this.obj = $(this.opts.obj)).length) return;
            this.init();
        }
        scrollBannerComponent.prototype = {
            init: function() {
                this.callComponent();
            },
            callComponent: function() {
                var _this = this;
                for (var i = 0, max = this.obj.length; i < max; i++) {
                    (function(index) {
                        var instace = new win.scrollBannerComponent(_this.obj.eq(index));
                    })(i);
                }
            }
        };
        return new scrollBannerComponent();
    })();
    return scrollBannerComponent;
}))
</script>
</div>
</body>
</html>
