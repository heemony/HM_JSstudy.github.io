<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<!-- <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,target-densitydpi=medium-dpi"> -->
<title>bear</title>
<link rel="stylesheet" type="text/css" href="css/coca.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/vs2015.min.css"> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/bash.min.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div class="evt_wrap">
    <div class="evt_tit">
        <div class="tit_area">
            <h2 class="blind">1등 곰도 맞추고 100% 경품까지 폴라베어를 잡아라!</h2>
        </div>
    </div>

    <div class="evt_ct">
        <div class="evt_area">
            <p class="blind">100% 당첨! 가장먼저 도착하는 폴라베어를 맞춰주세요</p>
            <ul class="bxlst" id="clickLst">
            <li class="rabx">
                <input type="radio" name="beautybox" id="bx"/>
                <label for="bx"><span class="blind">스키타는 베어</span></label>
            </li>
            <li class="rabx">
                <input type="radio" name="beautybox" id="bx2"/>
                <label for="bx2"><span class="blind">보드타는 베어</span></label>
            </li>
            <li class="rabx">
                <input type="radio" name="beautybox" id="bx3"/>
                <label for="bx3"><span class="blind">스케이트 베어</span></label>
            </li>
            </ul>
            <a href="#" class="btn btn_app">choice</a>
        </div>
    </div>

    <div class="evt_ct2">
        <ul class="game_area sp" id="gameLst">
        <!-- [D] active : .winlane 클래스 추가 -->
        <li class="lane"><div class="sp gom"></div></li>
        <li class="lane2"><div class="sp gom"></div></li>
        <li class="lane3"><div class="sp gom"></div></li>
        </ul>
    </div>

    <div style="height:2000px"></div>

    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<script>
    
(function () {
    'use strict';

    var takeBear = {
        init: function() {
            this.setElements(); 
            this.bindEvents(); 
        },
        setElements: function() {
            this.appBtn = $('.btn_app');
            this.boxList = $('.bxlst');
            this.boxItem = this.boxList.children(); // li
            this.boxInput = this.boxItem.find('input');
            this.gameArea = $('.game_area');
            this.gameLane = this.gameArea.children();

        },
        initOpts: function() {
            this.changeInput = false;
            this.completeGame = false;
        },
        bindEvents: function() {
            this.appBtn.on('click', this.onClickFunc.bind(this));
            this.boxItem.on('change', 'input', this.onChangeFunc.bind(this)); // event.delegateTarget
            // [!] event.delegateTarget 이벤트 핸들러가 상위 요소가 추가 처리 될 때 사용
        },
        onClickFunc: function(e) {
            e.preventDefault();
            if( !this.changeInput ) {
                alert('곰을 선택하세요.')
            } else if ( this.completeGame ) {
                alert('게임 종료');
            } else {
                this.animateFunc();
            }
            
        },
        onChangeFunc: function(e) {
            console.log(e.delegateTarget) // 그 상위요소까지
            var target = $(e.delegateTarget); // 상위요소를 타겟으로 지정
            this.targetIndex = target.index(); // 인덱스 번호 가져오기 -> animateFunc에서 사용할 것.
            this.changeInput = true; // initOpts 값 true로 변경. (변경되었다는 뜻.)
        },

        animateFunc: function() {
            this.setRandomNum();

            if( this.num === this.targetIndex ) {
                this.setRandomNum();
                this.animateFunc();
            } else {
                var targetLane = this.gameLane.eq(this.num),

                    moveTarget = targetLane.find('.gom');
                targetLane.addClass('winlane');
                moveTarget.stop().animate( {
                    top: '115px'
                }, 500);
                this.completeGame = true;
            }
        },

        // (선택한 인덱스 제외) 선택을 하지 않은 인덱스 두 개가 랜덤으로 내려 올 수 있게 만들어주세요.
        // 배열 사용
        // math.random 사용
        setRandomNum: function() {
            var indexArr = [0, 1, 2]; 
            var randomNum = Math.floor(Math.random() * indexArr.length); // 배열 범위만큼 랜덤수를 뽑아서 
            this.num = randomNum;
        },
    }
    takeBear.init();
})();


</script>
</div>
</body>
</html>
